# ===========================================
# Hypothesis Arena v5.0.0 - Configuration
# ===========================================

# Server
NODE_ENV=development
PORT=25655
LOG_LEVEL=info

# ===========================================
# Database
# ===========================================
DATABASE_URL="file:./dev.db"

# Turso (production)
TURSO_DATABASE_URL="libsql://your-database.turso.io"
TURSO_AUTH_TOKEN="your_turso_auth_token_here"

# ===========================================
# WEEX API
# ===========================================
WEEX_API_KEY=
WEEX_SECRET_KEY=
WEEX_PASSPHRASE=
WEEX_BASE_URL=https://api-contract.weex.com
WEEX_WS_URL=wss://ws-contract.weex.com/v2/ws

# ===========================================
# AI Services
# ===========================================
AI_PROVIDER=gemini

# Google Gemini
GEMINI_API_KEY=
GEMINI_MODEL=gemini-2.5-flash

# OpenRouter (alternative)
# Check https://openrouter.ai/models for current model availability.
# Model availability changes frequently - verify before use.
# 
# Recommended models (as of Jan 2026):
# - deepseek/deepseek-chat (DeepSeek V3 - good balance of cost/quality)
# - qwen/qwen-2.5-72b-instruct (fast, cheap, supports json_object)
# 
# The system uses json_object response format with fallback to prompt-based JSON.
OPENROUTER_API_KEY=
OPENROUTER_MODEL=deepseek/deepseek-chat

# AI Configuration
AI_MAX_OUTPUT_TOKENS=8192
AI_TEMPERATURE=0.8
AI_REQUEST_TIMEOUT_MS=60000
AI_MAX_RETRIES=3
AI_ANALYSIS_TIMEOUT_MS=90000
AI_MAX_TIMEOUT_MS=300000

# ===========================================
# Trading Configuration
# ===========================================
STARTING_BALANCE=1000
# MAX_DAILY_TRADES: Maximum trades per day (used by trading.maxDailyTrades).
# This is a SEPARATE limit from MAX_TRADES_PER_DAY in anti-churn section below.
# 
# RELATIONSHIP BETWEEN THE TWO LIMITS:
# - MAX_DAILY_TRADES (here): General trading limit, typically set higher (20) as a safety net.
#   Used by the trading engine for overall daily trade counting.
# - MAX_TRADES_PER_DAY (anti-churn): Stricter limit (10) enforced by AntiChurnService.
#   This is the primary limit that prevents overtrading.
# 
# In practice, MAX_TRADES_PER_DAY (10) will be hit first, making MAX_DAILY_TRADES (20)
# a secondary safety net. Both limits reset at midnight UTC.
MAX_DAILY_TRADES=20

# ===========================================
# Autonomous Trading Engine
# ===========================================
CYCLE_INTERVAL_MS=300000
MIN_TRADE_INTERVAL_MS=180000
MAX_POSITION_SIZE_PERCENT=20
MIN_BALANCE_TO_TRADE=30
# Leverage Configuration:
# - MIN_LEVERAGE (hardcoded in LeverageService): 3x - absolute minimum for any trade
# - DEFAULT_LEVERAGE: Starting point for dynamic calculation (5x recommended)
# - MAX_LEVERAGE: Hard cap that cannot be exceeded (10x max)
# Dynamic leverage (3-10x) adjusts based on confidence/volatility within these bounds.
# The system will NEVER use leverage below 3x or above MAX_LEVERAGE.
DEFAULT_LEVERAGE=5
MAX_LEVERAGE=10
STOP_LOSS_PERCENT=4
TAKE_PROFIT_PERCENT=8
# MIN_CONFIDENCE_TO_TRADE: Minimum AI confidence (0-100) required to execute a trade.
# Default 50 is the minimum threshold - trades below this are rejected regardless of other factors.
# For more conservative operation, consider 60-70 (fewer but higher-quality trades).
# For aggressive operation, 50 is acceptable but increases trade frequency with mixed quality.
MIN_CONFIDENCE_TO_TRADE=50
MAX_RETRIES=3
DRY_RUN=false

# Risk Management
MAX_CONCURRENT_POSITIONS=6
MAX_SAME_DIRECTION_POSITIONS=4
MAX_RISK_PER_TRADE_PERCENT=2
MAX_CONCURRENT_RISK_PERCENT=12
# NET_EXPOSURE percentages: These are INDEPENDENT directional limits, not additive.
# 
# HOW THEY WORK:
# - LONG limit (60%): Maximum portfolio allocation to LONG positions
# - SHORT limit (50%): Maximum portfolio allocation to SHORT positions
# 
# EXAMPLE SCENARIOS:
# 1. 60% LONG + 0% SHORT = Valid (within both limits)
# 2. 0% LONG + 50% SHORT = Valid (within both limits)
# 3. 60% LONG + 50% SHORT = Valid (hedged position, gross 110%, net 10% long)
# 4. 70% LONG + 0% SHORT = INVALID (exceeds LONG limit)
# 
# This design allows hedged positions while limiting directional risk.
# Net directional exposure = |LONG% - SHORT%| is implicitly capped at max(60%, 50%) = 60%.
NET_EXPOSURE_LONG_PERCENT=60
NET_EXPOSURE_SHORT_PERCENT=50
WEEKLY_DRAWDOWN_LIMIT_PERCENT=10
MAX_SECTOR_POSITIONS=3
# MAX_FUNDING_AGAINST_BPS: Maximum adverse funding rate in basis points (1 bps = 0.01%).
# If position is against funding direction and rate exceeds this, leverage is reduced.
# 5 bps = 0.05% per 8-hour period. WEEX charges funding every 8 hours.
# Example: 5 bps = 0.05% per period = 0.15% daily cost if held 24h against funding.
MAX_FUNDING_AGAINST_BPS=5

# ===========================================
# Trading Style
# ===========================================
TRADING_STYLE=scalp

# Scalping Parameters
SCALP_TARGET_PROFIT_PERCENT=5
SCALP_STOP_LOSS_PERCENT=5
SCALP_MAX_HOLD_HOURS=12
SCALP_TP_THRESHOLD_1=2
SCALP_TP_THRESHOLD_2=3
SCALP_TP_THRESHOLD_3=4
SCALP_TP_THRESHOLD_4=5
SCALP_MIN_RR_RATIO=1.5

# Swing Trading Parameters
SWING_TARGET_PROFIT_PERCENT=10
SWING_STOP_LOSS_PERCENT=6
SWING_MAX_HOLD_HOURS=48
SWING_TP_THRESHOLD_1=3
SWING_TP_THRESHOLD_2=5
SWING_TP_THRESHOLD_3=8
SWING_TP_THRESHOLD_4=10
SWING_MIN_RR_RATIO=2

# ===========================================
# Technical Indicators
# ===========================================
# INDICATOR_CACHE_TTL_MS: How long indicator calculations are cached (milliseconds).
# Lower values = fresher data but more API calls. Higher values = less load but staler data.
# 60000ms (1 minute) is a good balance for 5-minute candle data.
INDICATOR_CACHE_TTL_MS=60000
# INDICATOR_CANDLE_LIMIT_5M: Number of 5-minute candles to fetch for intraday indicators.
# Minimum 50 required for EMA(50). 100 provides buffer for calculation warmup.
INDICATOR_CANDLE_LIMIT_5M=100
# INDICATOR_CANDLE_LIMIT_4H: Number of 4-hour candles to fetch for long-term indicators.
# Minimum 200 required for EMA(200). This covers ~33 days of data.
INDICATOR_CANDLE_LIMIT_4H=200

# ===========================================
# Anti-Churn (v5.0.0)
# Prevents overtrading by enforcing cooldowns and limits.
# ===========================================
# COOLDOWN_AFTER_TRADE_MS: Minimum wait time (ms) before trading same symbol again.
# 900000ms = 15 minutes. Prevents rapid re-entry after exit.
COOLDOWN_AFTER_TRADE_MS=900000
# COOLDOWN_BEFORE_FLIP_MS: Minimum wait time (ms) before reversing direction on a symbol.
# 1800000ms = 30 minutes. Prevents whipsawing between LONG/SHORT.
COOLDOWN_BEFORE_FLIP_MS=1800000
# MAX_TRADES_PER_DAY: Hard limit on total trades per UTC day. Resets at midnight UTC.
MAX_TRADES_PER_DAY=10
# HYSTERESIS_MULTIPLIER: Confidence multiplier required to close vs open.
# 1.2 = need 20% more confidence to close than original entry confidence.
# Prevents premature exits on minor fluctuations.
HYSTERESIS_MULTIPLIER=1.2
# FUNDING_PERIODS_PER_DAY: Number of funding periods per day.
# WEEX/Binance/Bybit/OKX = 3 (8-hour periods), dYdX = 24 (1-hour periods).
# Used to calculate daily funding cost from per-period rate.
FUNDING_PERIODS_PER_DAY=3

# ===========================================
# Compliance
# ===========================================
REQUIRE_AI_LOGS=true

# ===========================================
# CORS
# ===========================================
CORS_ORIGINS=http://localhost:25655,http://localhost:3000

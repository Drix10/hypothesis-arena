# Hypothesis Arena v5.5.0 (HYBRID AI EDITION)

NODE_ENV=production
PORT=25655
LOG_LEVEL=info

# Database
DATABASE_URL="file:./dev.db"
TURSO_DATABASE_URL="libsql://your-database.turso.io"
TURSO_AUTH_TOKEN="your_turso_auth_token"

# WEEX API
WEEX_API_KEY=your_weex_api_key
WEEX_SECRET_KEY=your_weex_secret_key
WEEX_PASSPHRASE=your_weex_passphrase
WEEX_BASE_URL=https://api-contract.weex.com
WEEX_WS_URL=wss://ws-contract.weex.com/v2/ws
DEBUG_WEEX=false

# =============================================================================
# AI PROVIDER CONFIGURATION (v5.5.0 - HYBRID MODE)
# =============================================================================
# Hybrid mode splits analysts across providers for diversity and resilience:
# - jim, ray → DeepSeek via OpenRouter (fast, cost-effective)
# - karen, quant → Gemini 3.0 Flash (stable, structured output)
# - Judge → OpenRouter (for reliable final decisions)
# =============================================================================

AI_PROVIDER=openrouter
GEMINI_API_KEY=your_gemini_api_key
GEMINI_MODEL=gemini-3-flash-preview
OPENROUTER_API_KEY=your_openrouter_api_key
OPENROUTER_MODEL=deepseek/deepseek-chat

# AI Generation Settings
AI_MAX_OUTPUT_TOKENS=8192
AI_TEMPERATURE=0.7
AI_REQUEST_TIMEOUT_MS=120000
AI_MAX_RETRIES=3

# Hybrid AI Mode - Use both Gemini and OpenRouter simultaneously
AI_HYBRID_MODE=true

# Per-analyst provider assignment
ANALYST_JIM_PROVIDER=openrouter
ANALYST_RAY_PROVIDER=openrouter
ANALYST_KAREN_PROVIDER=gemini
ANALYST_QUANT_PROVIDER=gemini

# Judge uses Openrouter for reliable final decisions
JUDGE_PROVIDER=openrouter

# Trading (BALANCED COMPETITION MODE - ACTIVE TRADING)
COMPETITION_MODE=true
COMPETITION_MODE_ACK=I_ACCEPT_DEMO_ONLY_RISK_MANAGED_SETTINGS
WEEX_ACCOUNT_TYPE=demo
STARTING_BALANCE=1000
CYCLE_INTERVAL_MS=300000
MIN_BALANCE_TO_TRADE=300
MIN_CONFIDENCE_TO_TRADE=75
MAX_DAILY_TRADES=20
DRY_RUN=false

# Risk (AGGRESSIVE - FOCUSED STRIKES)
MAX_CONCURRENT_POSITIONS=3
MAX_SAME_DIRECTION_POSITIONS=2
WEEKLY_DRAWDOWN_LIMIT_PERCENT=20

# Position urgency thresholds
TARGET_PROFIT_PCT=2.5
STOP_LOSS_PCT=2.0
MAX_HOLD_HOURS=96
PARTIAL_TP_PCT=1.2
STALE_POSITION_HOURS=24
STALE_PNL_THRESHOLD=0.5
INDICATOR_CACHE_TTL_MS=60000

# AI confidence thresholds (0-100)
MODERATE_CONFIDENCE_THRESHOLD=75
HIGH_CONFIDENCE_THRESHOLD=80
VERY_HIGH_CONFIDENCE_THRESHOLD=88

# Position sizing (percentage of starting balance)
MIN_POSITION_PERCENT=10
TARGET_POSITION_MIN_PERCENT=25
TARGET_POSITION_MAX_PERCENT=35
MAX_POSITION_PERCENT=40

# Deployment limits
TARGET_DEPLOYMENT_PERCENT=80
MAX_DEPLOYMENT_PERCENT=95

# Monte Carlo validation thresholds
MC_MIN_SHARPE_RATIO=1.0
MC_TARGET_SHARPE_RATIO=1.5
MC_EXCELLENT_SHARPE_RATIO=2.0
MC_MIN_WIN_RATE=0.50
MC_MAX_DRAWDOWN_PERCENT=35

# Q-value (RL) thresholds
Q_VALUE_MINIMUM=0.40
Q_VALUE_CONSENSUS=0.50
Q_VALUE_HIGH_CONFIDENCE=0.70

# Leverage scaling by exposure (percentage multipliers)
LEVERAGE_SCALE_40PCT_MULT=0.90
LEVERAGE_SCALE_50PCT_MULT=0.80

# Global risk limits
MAX_SAFE_LEVERAGE=18
AUTO_APPROVE_LEVERAGE_THRESHOLD=15
ABSOLUTE_MAX_LEVERAGE=20
MAX_POSITION_SIZE_PERCENT=40
MAX_TOTAL_LEVERAGED_CAPITAL_PERCENT=95
MAX_RISK_PER_TRADE_PERCENT=10
MAX_CONCURRENT_RISK_PERCENT=25

# Correlation risk thresholds
ENABLE_CORRELATION_CHECKS=true
HIGH_CORRELATION_THRESHOLD=0.85
MAX_CORRELATED_POSITIONS=2
BTC_CORRELATION_WARNING=0.80

# Circuit breaker thresholds
CIRCUIT_YELLOW_BTC_DROP_4H=10
CIRCUIT_YELLOW_DRAWDOWN_24H=12
CIRCUIT_RED_BTC_DROP_4H=15
CIRCUIT_RED_DRAWDOWN_24H=20

# Stop loss requirements by leverage tier
SL_LOW_MAX_LEVERAGE=5
SL_LOW_MAX_STOP_PERCENT=5.0
SL_MEDIUM_MAX_LEVERAGE=10
SL_MEDIUM_MAX_STOP_PERCENT=3.0
SL_HIGH_MAX_LEVERAGE=15
SL_HIGH_MAX_STOP_PERCENT=2.5
SL_EXTREME_MAX_LEVERAGE=20
SL_EXTREME_MAX_STOP_PERCENT=2.0

# Risk Council limits
MAX_FUNDING_AGAINST_PERCENT=0.005
MAX_SECTOR_POSITIONS=5
NET_EXPOSURE_LIMIT_LONG=200
NET_EXPOSURE_LIMIT_SHORT=200

# Anti-Churn (Active Trading)
MAX_TRADES_PER_SYMBOL_PER_HOUR=3
HYSTERESIS_MULTIPLIER=1.1
FUNDING_PERIODS_PER_DAY=3
COOLDOWN_AFTER_TRADE_MS=300000
COOLDOWN_BEFORE_FLIP_MS=600000

CORS_ORIGINS=http://localhost:25655,http://localhost:3000

# News & Sentiment APIs
NEWSDATA_API_KEY=your_newsdata_api_key

# Admin endpoints
AUTONOMOUS_ADMIN_ENABLED=true
AUTONOMOUS_ADMIN_TOKEN=change_me

# Reddit sentiment
REDDIT_SENTIMENT_ENABLED=true
REDDIT_USER_AGENT=HypothesisArena/5.5.0-deepseek (trading bot, respectful)

# ═══════════════════════════════════════════════════════════════════════════════
# PRODUCTION TUNING (v5.4.1) - OPTIMIZED FOR COMPETITION MODE
# ═══════════════════════════════════════════════════════════════════════════════

# Monte Carlo Simulation
MC_TRADING_COST_PCT=0.08
MC_FUNDING_COST_PCT=0.01
MC_STUDENT_T_DF=5
MC_GARCH_ALPHA=0.05
MC_GARCH_BETA=0.90
MC_TRADES_PER_YEAR=2000

# Regime Detection
# More history = better regime detection, but more memory
REGIME_HISTORY_MAX=30
REGIME_HISTORY_MAX_SYMBOLS=100
# Cleanup every 2 cycles (16 min)
REGIME_CLEANUP_INTERVAL_MS=960000
# Keep 48h of regime history for better trend detection
REGIME_MAX_AGE_MS=172800000

# Quant Analysis Cache
# TTL = 1 cycle (8 min) - fresh data each cycle
QUANT_CACHE_TTL_MS=480000
# Higher cache size for multi-symbol trading
QUANT_MAX_CACHE_SIZE=200

# Funding Rate History
# 7 days of funding history for percentile calculation (21 × 8h = 7 days)
FUNDING_HISTORY_MAX_ENTRIES=21
FUNDING_HISTORY_MAX_AGE_MS=604800000
# Track more symbols in competition mode
FUNDING_HISTORY_MAX_SYMBOLS=100

# Sentiment Service
# News cache = 3 cycles (24 min) - news doesn't change that fast
SENTIMENT_NEWS_CACHE_TTL_MS=1440000
# Fear & Greed updates daily, 2h cache is fine
SENTIMENT_FEAR_GREED_CACHE_TTL_MS=7200000
SENTIMENT_MAX_CACHE_SIZE=150
# Longer timeout for slow news APIs
SENTIMENT_REQUEST_TIMEOUT_MS=15000
# Fetch sentiment every cycle (8 min)
SENTIMENT_MIN_FETCH_INTERVAL_MS=480000
# BTC dominates crypto sentiment
SENTIMENT_BTC_WEIGHT=0.65
SENTIMENT_ETH_WEIGHT=0.35

# Reddit Sentiment
# Cache = 3 cycles (24 min) - social sentiment is slower moving
REDDIT_CACHE_TTL_MS=1440000
# Respectful rate limiting (3 sec between requests)
REDDIT_REQUEST_DELAY_MS=3000
REDDIT_REQUEST_TIMEOUT_MS=12000
# Stale threshold = 2.5 cycles (20 min)
REDDIT_STALE_THRESHOLD_MS=1200000
# Only recent posts matter for trading
REDDIT_MAX_POST_AGE_HOURS=12
REDDIT_MAX_CACHE_SIZE=75

# Position Sync
# Track more trades in competition mode
POSITION_MAX_TRACKED_TRADES=200
# Shorter stale threshold for active trading (48h)
POSITION_STALE_TRADE_HOURS=48
# Tighter threshold for win/loss classification (0.5%)
POSITION_OUTCOME_THRESHOLD_PCT=0.5
# Faster removal of missing positions
POSITION_MISSING_CYCLE_THRESHOLD=2

# Analyst Portfolio
PORTFOLIO_RECENT_TRADES_LIMIT=20
# Longer lock timeout for production stability
PORTFOLIO_LOCK_TIMEOUT_MS=45000
PORTFOLIO_MAX_RETRIES=3
PORTFOLIO_RETRY_DELAY_MS=1500

# WEEX Client
# Longer timeout for production (180 sec) - WEEX can be slow
WEEX_REQUEST_TIMEOUT_MS=180000
# More retry attempts for production reliability
WEEX_RATE_LIMIT_MAX_ATTEMPTS=30
# Longer max wait for rate limits (90 sec)
WEEX_RATE_LIMIT_MAX_WAIT_MS=90000

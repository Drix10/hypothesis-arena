# ===========================================
# Hypothesis Arena - Configuration
# ===========================================

# Server
NODE_ENV=development
PORT=25655
LOG_LEVEL=info

# ===========================================
# Database
# ===========================================
# Local SQLite (used by Prisma CLI for schema management)
DATABASE_URL="file:./dev.db"

# Turso (used in production runtime)
TURSO_DATABASE_URL="libsql://your-database.turso.io"
TURSO_AUTH_TOKEN="your_turso_auth_token_here"

# ===========================================
# WEEX API (Live Trading)
# ===========================================
# Get credentials from: https://www.weex.com/api
WEEX_API_KEY=
WEEX_SECRET_KEY=
WEEX_PASSPHRASE=
WEEX_BASE_URL=https://api-contract.weex.com
WEEX_WS_URL=wss://ws-contract.weex.com/v2/ws

# ===========================================
# AI Services
# ===========================================
# AI Provider: gemini or openrouter (default: gemini)
AI_PROVIDER=gemini

# Google Gemini API - Get key from: https://aistudio.google.com/apikey
GEMINI_API_KEY=
GEMINI_MODEL=gemini-2.5-flash

# OpenRouter API - Get key from: https://openrouter.ai/keys
OPENROUTER_API_KEY=

# OpenRouter Model (default: deepseek/deepseek-chat-v3.1)
# Other options: anthropic/claude-3.5-sonnet, qwen/qwen-2.5-72b-instruct, google/gemini-2.0-flash-exp:free
OPENROUTER_MODEL=deepseek/deepseek-chat-v3.1

# AI Configuration
AI_MAX_OUTPUT_TOKENS=8192
AI_DEBATE_MAX_TOKENS=8192
AI_SPECIALIST_MAX_TOKENS=8192
AI_MAX_PROMPT_LINES=250
AI_TEMPERATURE=0.8
AI_REQUEST_TIMEOUT_MS=60000
AI_MAX_RETRIES=3
AI_ANALYSIS_TIMEOUT_MS=90000
AI_MAX_TIMEOUT_MS=300000

# ===========================================
# Trading Configuration
# ===========================================
MAX_POSITION_SIZE=0.2
MAX_TOTAL_INVESTED=0.8
MAX_DAILY_TRADES=20
DRAWDOWN_PAUSE_THRESHOLD=0.3
DRAWDOWN_LIQUIDATE_THRESHOLD=0.8
MAX_LEVERAGE=5

# ===========================================
# Autonomous Trading Engine
# ===========================================
CYCLE_INTERVAL_MS=600000
MIN_TRADE_INTERVAL_MS=900000
DEBATE_FREQUENCY=3
MAX_POSITION_SIZE_PERCENT=30
MIN_BALANCE_TO_TRADE=10
DEFAULT_LEVERAGE=3
# Stop loss tolerance (4-8% recommended for 5x leverage)
# At 5x leverage: 5% stop = 25% account loss per position (manageable)
# Conservative: 4%, Moderate: 5%, Aggressive: 6-8%
STOP_LOSS_PERCENT=5
TAKE_PROFIT_PERCENT=10
MIN_CONFIDENCE_TO_TRADE=60
MIN_CONSENSUS_TO_TRADE=2
MAX_RETRIES=3
DRY_RUN=false

# Risk Management Limits
# IMPORTANT: These are aggressive defaults - review and adjust based on your risk tolerance
# NOTE: All *_PERCENT values use INTEGER percentages (e.g., 40 = 40%, not 0.40)
# Conservative = lower values, Aggressive = higher values
#
# PARAMETER INTERDEPENDENCIES:
# - MAX_SAME_DIRECTION_POSITIONS must be <= MAX_CONCURRENT_POSITIONS
# - MAX_CONCURRENT_RISK_PERCENT should be >= MAX_RISK_PER_TRADE_PERCENT × MAX_CONCURRENT_POSITIONS
#   Current: 6% >= 2% × 3 = 6% ✓ (exactly at limit)
# - NET_EXPOSURE_*_PERCENT × DEFAULT_LEVERAGE = actual market exposure (e.g., 60% × 5x = 300%)
# - WEEKLY_DRAWDOWN_LIMIT_PERCENT should trigger before DRAWDOWN_LIQUIDATE_THRESHOLD (80%)

MAX_CONCURRENT_POSITIONS=3           # Max total open positions at once (1-5 recommended). Conservative: 2-3, Aggressive: 4-5
MAX_SAME_DIRECTION_POSITIONS=2       # Max positions in same direction (LONG or SHORT). Must be <= MAX_CONCURRENT_POSITIONS. Conservative: 1-2, Aggressive: 3-4. Limits directional risk.
MAX_RISK_PER_TRADE_PERCENT=2         # Max account % risked per single trade (1-5). Conservative: 1-2%, Aggressive: 3-5%. Based on stop loss distance × position size.
MAX_CONCURRENT_RISK_PERCENT=6        # Max total account % at risk across all positions (3-10). Conservative: 3-5%, Aggressive: 8-10%. Sum of all position risks. Must be >= MAX_RISK_PER_TRADE × MAX_CONCURRENT_POSITIONS.
NET_EXPOSURE_LONG_PERCENT=60         # Max net LONG exposure as % of portfolio (margin used, not notional). Conservative: 40-50%, Aggressive: 60-80%. With 5x leverage, 60% margin = 300% notional.
NET_EXPOSURE_SHORT_PERCENT=50        # Max net SHORT exposure as % of portfolio (margin used, not notional). Conservative: 30-40%, Aggressive: 50-70%. Typically lower than LONG due to unlimited downside risk.
WEEKLY_DRAWDOWN_LIMIT_PERCENT=10     # Max portfolio drawdown per week before reducing risk (5-20). Conservative: 5-10%, Aggressive: 15-20%. Triggers position size reduction.
MAX_SECTOR_POSITIONS=3               # Max positions in same sector (e.g., L1s, memes). Conservative: 2, Aggressive: 3-4.

# Funding Rate Limits (in BASIS POINTS - 1 bp = 0.01%)
# WEEX funding rates are typically 1-10 basis points per 8h period
# Examples: 5 = 0.05%, 10 = 0.10%, 1 = 0.01%
MAX_FUNDING_AGAINST_BPS=5            # Max funding rate against position per 8h (basis points). 5 bps = 0.05%. Conservative: 3-5, Aggressive: 8-10.
FUNDING_WARN_THRESHOLD_BPS=1         # Funding rate warning threshold (basis points). 1 bp = 0.01%.

# Circuit Breakers
ENABLE_CIRCUIT_BREAKERS=true
CIRCUIT_BREAKER_CHECK_INTERVAL_MS=60000
CIRCUIT_BREAKER_CACHE_DURATION_MS=60000

# ===========================================
# Debate Configuration
# ===========================================
DEBATE_TURNS_PER_ANALYST=2           # Turns per analyst in debates. 2 = 24 total turns (8+16)
DEBATE_WEIGHT_DATA=25                # Scoring weight for data quality (0-100, must sum to 100)
DEBATE_WEIGHT_LOGIC=25               # Scoring weight for logic (0-100)
DEBATE_WEIGHT_RISK=25                # Scoring weight for risk awareness (0-100)
DEBATE_WEIGHT_CATALYST=25            # Scoring weight for catalyst clarity (0-100)
DEBATE_MIN_ARGUMENT_LENGTH=100       # Minimum argument length in characters
DEBATE_TURN_DELAY_MS=300             # Delay between turns to avoid rate limiting
DEBATE_WEIGHT_CONCENTRATION_THRESHOLD_PCT=70  # Warn if any single weight exceeds this %

# Per-Analyst Stop Loss Overrides (optional, defaults to STOP_LOSS_PERCENT)
# These values are calibrated for 5x leverage (5% stop = 25% effective risk)
# STOP_LOSS_VALUE=5
# STOP_LOSS_GROWTH=5
# STOP_LOSS_TECHNICAL=4
# STOP_LOSS_MACRO=5
# STOP_LOSS_SENTIMENT=5
# STOP_LOSS_RISK=4
# STOP_LOSS_QUANT=5
# STOP_LOSS_CONTRARIAN=4
# STOP_LOSS_ENFORCEMENT_MULTIPLIER=1

# ===========================================
# Compliance
# ===========================================
REQUIRE_AI_LOGS=true

# ===========================================
# Trading Style Configuration
# ===========================================
# TRADING_STYLE: 'scalp' for high-frequency small profits, 'swing' for larger moves
# Scalping: Many small wins ($3 on $30 = 10% ROI), quick entries/exits
# Swing: Fewer trades, larger targets, longer hold times
TRADING_STYLE=scalp
#
# PARAMETER PRECEDENCE:
# When TRADING_STYLE is set, style-specific parameters (SCALP_* or SWING_*) take
# precedence over global parameters (STOP_LOSS_PERCENT, TAKE_PROFIT_PERCENT).
# Example: If TRADING_STYLE=scalp, SCALP_STOP_LOSS_PERCENT overrides STOP_LOSS_PERCENT.
# Global parameters are used as fallbacks when style-specific values are not set.
#
# TARGET PROFIT vs TAKE-PROFIT THRESHOLDS:
# - TARGET_PROFIT_PERCENT: The overall profit goal for the position
# - TP_THRESHOLD_1-4: Incremental profit levels for partial exits
# - IMPORTANT: TARGET_PROFIT should be >= TP_THRESHOLD_4 (the highest threshold)
#   Otherwise, positions may close before reaching the 75% profit-taking level.
# - Example: If TARGET=5% and TP4=7%, the position will close at 5% before TP4 triggers.
#   Recommended: TARGET >= TP4 (e.g., TARGET=7% with TP4=7%, or TARGET=8% with TP4=7%)

# --- Scalping Parameters (used when TRADING_STYLE=scalp) ---
# Target profit % (1-50, default 5) - should be >= SCALP_TP_THRESHOLD_4
SCALP_TARGET_PROFIT_PERCENT=5
# Stop loss % (0.5-20, default 3) - overrides global STOP_LOSS_PERCENT when TRADING_STYLE=scalp
SCALP_STOP_LOSS_PERCENT=3
# Max hold time in hours before forcing review (default 12)
SCALP_MAX_HOLD_HOURS=12
# Take profit thresholds (MUST be in ascending order: TP1 < TP2 < TP3 < TP4)
SCALP_TP_THRESHOLD_1=2    # Move stop to breakeven at +2%
SCALP_TP_THRESHOLD_2=3    # Take 25% profits at +3%
SCALP_TP_THRESHOLD_3=4    # Take 50% profits at +4%
SCALP_TP_THRESHOLD_4=5    # Take 75% profits at +5% (should be <= TARGET_PROFIT)
# Minimum risk/reward ratio (can be lower for high-probability scalps)
SCALP_MIN_RR_RATIO=1.5

# --- Swing Trading Parameters (used when TRADING_STYLE=swing) ---
# Target profit % (5-100, default 10) - should be >= SWING_TP_THRESHOLD_4
SWING_TARGET_PROFIT_PERCENT=10
# Stop loss % (2-30, default 5) - overrides global STOP_LOSS_PERCENT when TRADING_STYLE=swing
SWING_STOP_LOSS_PERCENT=5
# Max hold time in hours before forcing review (default 48)
SWING_MAX_HOLD_HOURS=48
# Take profit thresholds (MUST be in ascending order: TP1 < TP2 < TP3 < TP4)
SWING_TP_THRESHOLD_1=3    # Move stop to breakeven at +3%
SWING_TP_THRESHOLD_2=5    # Take 25% profits at +5%
SWING_TP_THRESHOLD_3=8    # Take 50% profits at +8%
SWING_TP_THRESHOLD_4=10   # Take 75% profits at +10% (should be <= TARGET_PROFIT)
# Minimum risk/reward ratio for swing trades
SWING_MIN_RR_RATIO=2

# ===========================================
# CORS
# ===========================================
CORS_ORIGINS=http://localhost:25655,http://localhost:3000
